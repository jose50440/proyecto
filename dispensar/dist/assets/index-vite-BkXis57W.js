import{r as j,a as G,R as Z}from"./vendor-wGySg1uH.js";import{c as Q}from"./supabase-CQnWzhEg.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))u(l);new MutationObserver(l=>{for(const r of l)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&u(i)}).observe(document,{childList:!0,subtree:!0});function a(l){const r={};return l.integrity&&(r.integrity=l.integrity),l.referrerPolicy&&(r.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?r.credentials="include":l.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function u(l){if(l.ep)return;l.ep=!0;const r=a(l);fetch(l.href,r)}})();var H={exports:{}},M={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ee=j,te=Symbol.for("react.element"),se=Symbol.for("react.fragment"),re=Object.prototype.hasOwnProperty,oe=ee.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ne={key:!0,ref:!0,__self:!0,__source:!0};function V(t,o,a){var u,l={},r=null,i=null;a!==void 0&&(r=""+a),o.key!==void 0&&(r=""+o.key),o.ref!==void 0&&(i=o.ref);for(u in o)re.call(o,u)&&!ne.hasOwnProperty(u)&&(l[u]=o[u]);if(t&&t.defaultProps)for(u in o=t.defaultProps,o)l[u]===void 0&&(l[u]=o[u]);return{$$typeof:te,type:t,key:r,ref:i,props:l,_owner:oe.current}}M.Fragment=se;M.jsx=V;M.jsxs=V;H.exports=M;var e=H.exports,$={},B=G;$.createRoot=B.createRoot,$.hydrateRoot=B.hydrateRoot;const ie="modulepreload",ae=function(t){return"/"+t},F={},le=function(o,a,u){let l=Promise.resolve();if(a&&a.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),x=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));l=Promise.allSettled(a.map(d=>{if(d=ae(d),d in F)return;F[d]=!0;const y=d.endsWith(".css"),v=y?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${v}`))return;const p=document.createElement("link");if(p.rel=y?"stylesheet":ie,y||(p.as="script"),p.crossOrigin="",p.href=d,x&&p.setAttribute("nonce",x),document.head.appendChild(p),y)return new Promise((_,s)=>{p.addEventListener("load",_),p.addEventListener("error",()=>s(new Error(`Unable to preload CSS for ${d}`)))})}))}function r(i){const x=new Event("vite:preloadError",{cancelable:!0});if(x.payload=i,window.dispatchEvent(x),!x.defaultPrevented)throw i}return l.then(i=>{for(const x of i||[])x.status==="rejected"&&r(x.reason);return o().catch(r)})},C=({path:t,size:o=20,className:a=""})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:o,height:o,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.75",strokeLinecap:"round",strokeLinejoin:"round",className:a,children:t}),S={Truck:t=>e.jsx(C,{...t,path:e.jsxs(e.Fragment,{children:[e.jsx("path",{d:"M16 3h5l5 5v11a2 2 0 0 1-2 2h-2"}),e.jsx("path",{d:"M16 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h2"}),e.jsx("circle",{cx:"5.5",cy:"18.5",r:"2.5"}),e.jsx("circle",{cx:"18.5",cy:"18.5",r:"2.5"})]})}),Box:t=>e.jsx(C,{...t,path:e.jsxs(e.Fragment,{children:[e.jsx("path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"}),e.jsx("polyline",{points:"3.27 6.96 12 12.01 20.73 6.96"}),e.jsx("line",{x1:"12",y1:"22.08",x2:"12",y2:"12"})]})}),Search:t=>e.jsx(C,{...t,path:e.jsxs(e.Fragment,{children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]})}),X:t=>e.jsx(C,{...t,path:e.jsxs(e.Fragment,{children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})}),ArrowLeft:t=>e.jsx(C,{...t,path:e.jsxs(e.Fragment,{children:[e.jsx("line",{x1:"19",y1:"12",x2:"5",y2:"12"}),e.jsx("polyline",{points:"12 19 5 12 12 5"})]})}),LogOut:t=>e.jsx(C,{...t,path:e.jsxs(e.Fragment,{children:[e.jsx("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}),e.jsx("polyline",{points:"16 17 21 12 16 7"}),e.jsx("line",{x1:"21",y1:"12",x2:"9",y2:"12"})]})}),Menu:t=>e.jsx(C,{...t,path:e.jsxs(e.Fragment,{children:[e.jsx("line",{x1:"4",y1:"6",x2:"20",y2:"6"}),e.jsx("line",{x1:"4",y1:"12",x2:"20",y2:"12"}),e.jsx("line",{x1:"4",y1:"18",x2:"20",y2:"18"})]})}),LayoutDashboard:t=>e.jsx(C,{...t,path:e.jsxs(e.Fragment,{children:[e.jsx("rect",{x:"3",y:"3",width:"7",height:"9",rx:"1"}),e.jsx("rect",{x:"14",y:"3",width:"7",height:"9",rx:"1"}),e.jsx("rect",{x:"14",y:"14",width:"7",height:"7",rx:"1"}),e.jsx("rect",{x:"3",y:"14",width:"7",height:"7",rx:"1"})]})}),Pill:t=>e.jsx(C,{...t,path:e.jsxs(e.Fragment,{children:[e.jsx("path",{d:"M10.5 20.5L3 13a4 4 0 015.657-5.657l7.5 7.5a4 4 0 01-5.657 5.657z"}),e.jsx("path",{d:"M13.5 3.5L21 11a4 4 0 01-5.657 5.657l-7.5-7.5a4 4 0 015.657-5.657z"})]})})};function de({onLogin:t}){const[o,a]=j.useState(""),[u,l]=j.useState(""),[r,i]=j.useState(!1),[x,d]=j.useState(null),y=async v=>{v.preventDefault(),d(null),i(!0);try{const p=(await le(async()=>{const{getDb:N}=await Promise.resolve().then(()=>je);return{getDb:N}},void 0)).getDb(),_=o.trim().toLowerCase(),s=await p.collection("prod_users").where("username","==",_).get();if(s.empty){d("Usuario o contraseña incorrectos"),i(!1);return}const h=s.docs[0],n={id:h.id,...h.data()};if((n.password||"").toString().trim()!==u){d("Usuario o contraseña incorrectos"),i(!1);return}const f=(n.departamento||"").toLowerCase().trim(),c=(n.rolesDepartamento||[]).map(N=>(N||"").toLowerCase().trim());if(!(f==="logistica"&&(c.includes("asignador de rutas despacho logistica")||c.includes("supervisor")))){d("No tienes acceso a Logística. Debes ser del departamento Logística (asignador o supervisor)."),i(!1);return}const w=n.role||"digitador",b=n.nombre||n.username||"Usuario";t(w,b,{...n,departamento:n.departamento,rolesDepartamento:n.rolesDepartamento})}catch(p){d("Error: "+((p==null?void 0:p.message)||p))}i(!1)};return e.jsxs("div",{className:"relative flex min-h-screen items-center justify-center overflow-hidden bg-gradient-to-br from-turquoise-100 via-teal-50 to-clinical-50 p-6",children:[e.jsxs("div",{className:"pointer-events-none absolute inset-0",children:[e.jsx("div",{className:"absolute left-1/4 top-1/4 h-64 w-64 rounded-full bg-turquoise-300/20 blur-3xl"}),e.jsx("div",{className:"absolute bottom-1/4 right-1/4 h-80 w-80 rounded-full bg-clinical-400/15 blur-3xl"})]}),e.jsxs("div",{className:"relative z-10 w-full max-w-sm rounded-3xl border border-slate-200/60 bg-white p-10 shadow-xl",children:[e.jsxs("div",{className:"mb-10 text-center",children:[e.jsx("div",{className:"mx-auto mb-6 flex h-20 w-20 items-center justify-center overflow-hidden rounded-2xl border border-cyan-200/50 bg-cyan-100 shadow-lg",children:e.jsx(S.Truck,{size:40,className:"text-cyan-600"})}),e.jsxs("h1",{className:"text-2xl font-bold tracking-tight text-slate-800 font-display",children:["IHSS ",e.jsx("span",{className:"text-turquoise-600",children:"A TU CASA"})]}),e.jsx("p",{className:"mt-1 text-xs font-bold uppercase tracking-widest text-slate-400",children:"Logística — Asignación de rutas"})]}),e.jsxs("form",{onSubmit:y,className:"space-y-6",children:[x&&e.jsx("div",{className:"rounded-lg border border-red-100 bg-red-50 p-3 text-center text-xs font-bold text-red-500",children:x}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-xs font-bold uppercase text-slate-400",children:"Usuario"}),e.jsx("input",{type:"text",className:"w-full rounded-xl border border-slate-200/80 bg-white/70 px-4 py-3 outline-none transition-all focus:border-turquoise-500 focus:ring-2 focus:ring-turquoise-500/20",value:o,onChange:v=>a(v.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-xs font-bold uppercase text-slate-400",children:"Contraseña"}),e.jsx("input",{type:"password",className:"w-full rounded-xl border border-slate-200/80 bg-white/70 px-4 py-3 outline-none transition-all focus:border-turquoise-500 focus:ring-2 focus:ring-turquoise-500/20",value:u,onChange:v=>l(v.target.value),required:!0})]})]}),e.jsx("button",{type:"submit",disabled:r,className:"mt-4 w-full rounded-xl bg-gradient-to-r from-turquoise-500 to-clinical-500 py-3.5 font-bold text-white shadow-lg transition hover:opacity-95 focus:ring-2 focus:ring-turquoise-500/40 focus:ring-offset-2 disabled:opacity-50",children:r?"Verificando...":"Iniciar Sesión"})]}),e.jsxs("a",{href:"index.html",className:"mt-6 flex items-center justify-center gap-2 text-sm text-slate-500 transition-colors hover:text-turquoise-600",children:[e.jsx(S.ArrowLeft,{size:16})," Volver al inicio"]})]})]})}function ce({userName:t,role:o,kits:a=[],currentUser:u,setView:l}){const[r,i]=j.useState(new Date);j.useEffect(()=>{const p=setInterval(()=>i(new Date),1e3);return()=>clearInterval(p)},[]);const x=new Date().toISOString().split("T")[0],d=(a||[]).filter(p=>{const _=(p.fechaEntregaLogistica||"").toString().trim();return _&&_.slice(0,10)===x}),y=((u==null?void 0:u.departamento)||"").toLowerCase(),v=(u==null?void 0:u.rolesDepartamento)||[];return e.jsxs("div",{className:"mx-auto w-full max-w-6xl animate-in space-y-6 px-0",children:[e.jsxs("div",{className:"grid grid-cols-1 items-center gap-2 md:grid-cols-2",children:[e.jsxs("div",{className:"relative overflow-hidden rounded-2xl border border-turquoise-500/20 bg-gradient-to-r from-turquoise-600 via-turquoise-500 to-clinical-600 px-4 py-3 text-white shadow-lg md:rounded-3xl md:px-5 md:py-4",children:[e.jsx("div",{className:"absolute inset-0 pointer-events-none",children:e.jsx("div",{className:"futuro-orb -mr-24 -mt-24 top-0 right-0 h-48 w-48 rounded-full bg-white/10 blur-2xl"})}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("h1",{className:"mb-1 text-2xl font-bold font-display md:text-3xl",children:["¡Hola, ",t,"!"]}),e.jsx("p",{className:"text-xs font-medium uppercase tracking-wider opacity-90",children:"Logística — Asignación de rutas"}),(y||o||v&&v.length>0)&&e.jsxs("div",{className:"mt-2 flex flex-wrap gap-2 text-sm",children:[y&&e.jsxs("span",{className:"rounded-full bg-white/20 px-3 py-1 font-semibold",children:["Departamento: ",y]}),(v==null?void 0:v.length)>0?e.jsxs("span",{className:"rounded-full bg-white/20 px-3 py-1 font-semibold",children:[v.length===1?"Cargo: ":"Cargos: ",v.map(p=>p&&p.charAt(0).toUpperCase()+p.slice(1)||p).join(", ")]}):e.jsxs("span",{className:"rounded-full bg-white/20 px-3 py-1 font-semibold",children:["Rol: ",o==="superadmin"?"Super Admin":o==="supervisor"?"Supervisor":o==="admin"?"Administrador":o]})]})]})]}),e.jsx("div",{className:"flex items-center justify-center p-0",children:e.jsxs("div",{className:"rounded-xl bg-slate-100/80 p-8 text-center",children:[e.jsx("div",{className:"mb-2 font-mono text-5xl font-bold tracking-widest text-slate-700",children:r.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),e.jsx("div",{className:"text-sm font-medium uppercase text-slate-400",children:r.toLocaleDateString([],{weekday:"long",day:"numeric",month:"long"})})]})})]}),e.jsx("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-3",children:e.jsxs("div",{className:"flex items-center gap-4 rounded-3xl border border-slate-200/60 bg-white p-6 shadow-[0_4px_20px_-2px_rgba(25,68,144,0.15)]",children:[e.jsx("div",{className:"rounded-2xl bg-turquoise-50 p-4 text-turquoise-600",children:e.jsx(S.Box,{size:32})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl font-bold text-slate-800",children:d.length}),e.jsx("div",{className:"text-xs font-bold uppercase text-slate-400",children:"Kits en Logística Hoy"})]})]})}),e.jsx("h3",{className:"mt-8 text-xl font-bold text-slate-700 font-display",children:"Accesos directos"}),e.jsx("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4",children:e.jsxs("button",{type:"button",onClick:()=>l("medicamentos"),className:"group relative flex min-h-[100px] flex-col overflow-hidden rounded-2xl border border-slate-200/60 bg-white p-5 text-left shadow-[0_4px_20px_-2px_rgba(25,68,144,0.15)] transition-all duration-300 hover:-translate-y-1 hover:border-turquoise-300/40 hover:shadow-xl md:rounded-3xl md:p-6",children:[e.jsx("div",{className:"absolute -mr-4 -mt-4 top-0 right-0 h-24 w-24 rounded-bl-full bg-indigo-500 opacity-10 transition-transform group-hover:scale-110"}),e.jsx("div",{className:"mb-4 flex h-12 w-12 items-center justify-center rounded-2xl bg-indigo-500 text-white shadow-md transition-transform group-hover:scale-110",children:e.jsx(S.Pill,{size:24})}),e.jsx("h4",{className:"mb-1 font-bold text-lg text-slate-800 transition-colors group-hover:text-turquoise-600",children:"Medicamentos"}),e.jsx("p",{className:"text-xs text-slate-400",children:"No en kit · Renovar receta"})]})})]})}function ue(t=[],o=[]){const a=[];for(const u of t){const l=u.medicamentos||[],r=o.find(d=>d.id===u.patientId||d.dni&&u.dni&&String(d.dni).trim()===String(u.dni).trim()),i=u.nombre||(r==null?void 0:r.nombre)||"—",x=u.dni||(r==null?void 0:r.dni)||"—";for(let d=0;d<l.length;d++){const y=l[d];!y||typeof y!="object"||a.push({...y,_kitId:u.id,_patientId:u.patientId,_kitNombre:i,_kitDni:x,_medIndex:d})}}return a}function me(t){return(t||[]).filter(o=>o.vaEnKit===!1)}function xe(t){return(t||[]).filter(o=>o.requiereRenovarReceta===!0)}const A="noEnKit",U="renovarReceta";function fe({kits:t=[],patients:o=[]}){const[a,u]=j.useState(A),[l,r]=j.useState(""),i=j.useMemo(()=>ue(t,o),[t,o]),x=j.useMemo(()=>me(i),[i]),d=j.useMemo(()=>xe(i),[i]),y=s=>{const h=l.trim().toLowerCase();return h?s.filter(n=>(n.nombre||"").toLowerCase().includes(h)||(n._kitNombre||"").toLowerCase().includes(h)||(n._kitDni||"").toString().toLowerCase().includes(h)):s},v=y(x),p=y(d),_=a===A?v:p;return e.jsxs("div",{className:"mx-auto w-full max-w-5xl space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800 font-display",children:"Medicamentos"}),e.jsx("p",{className:"mt-1 text-sm text-slate-500",children:"Dos listas independientes: los que no van en kit y los que requieren renovar receta."})]}),e.jsx("div",{className:"flex flex-wrap gap-3",children:e.jsxs("div",{className:"inline-flex flex-wrap gap-2 rounded-2xl border border-slate-200/60 bg-slate-100/80 p-2.5",children:[e.jsxs("button",{type:"button",onClick:()=>u(A),className:`min-h-[40px] rounded-xl px-4 py-2.5 text-sm font-semibold transition-all ${a===A?"bg-white text-indigo-700 shadow-md ring-1 ring-indigo-200":"text-slate-600 hover:bg-white/70"}`,children:["Medicamentos que NO van en kit (",x.length,")"]}),e.jsxs("button",{type:"button",onClick:()=>u(U),className:`min-h-[40px] rounded-xl px-4 py-2.5 text-sm font-semibold transition-all ${a===U?"bg-white text-amber-700 shadow-md ring-1 ring-amber-200":"text-slate-600 hover:bg-white/70"}`,children:["Medicamentos que requieren renovar receta (",d.length,")"]})]})}),e.jsxs("div",{className:"rounded-3xl border-l-4 border-slate-200 bg-white shadow-[0_4px_20px_-2px_rgba(25,68,144,0.15)] overflow-hidden",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4 border-b border-slate-200 bg-slate-50/80 p-5",children:[e.jsxs("span",{className:"font-bold text-slate-800",children:[_.length,(a===A?v:p).length!==_.length?` de ${a===A?x.length:d.length}`:""," ","resultado(s)"]}),e.jsxs("div",{className:"relative w-full sm:w-64",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",children:e.jsx(S.Search,{size:16})}),e.jsx("input",{type:"text",placeholder:"Buscar por nombre o paciente...",value:l,onChange:s=>r(s.target.value),className:"w-full rounded-xl border border-slate-200 bg-white py-2 pl-9 pr-4 text-sm outline-none focus:border-cyan-300 focus:ring-1 focus:ring-cyan-200"})]})]}),e.jsx("div",{className:"max-h-[60vh] divide-y divide-slate-100 overflow-y-auto",children:_.length===0?e.jsxs("div",{className:"p-12 text-center text-slate-500",children:[e.jsx(S.Pill,{size:48,className:"mx-auto mb-3 opacity-40"}),e.jsx("p",{className:"font-medium",children:l.trim()?"Sin resultados para la búsqueda":a===A?"No hay medicamentos que no vayan en kit":"No hay medicamentos que requieran renovar receta"})]}):_.map((s,h)=>e.jsx("div",{className:"flex flex-wrap items-center gap-4 border-b border-slate-100 p-4 transition-colors last:border-b-0 hover:bg-slate-50/50",children:e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"font-bold text-slate-800",children:s.nombre||"—"}),e.jsxs("div",{className:"mt-1 flex flex-wrap gap-3 text-sm text-slate-500",children:[e.jsxs("span",{children:["Cantidad: ",s.cantidad??"—"]}),e.jsxs("span",{children:["Paciente: ",s._kitNombre||"—"]}),e.jsxs("span",{children:["DNI: ",s._kitDni||"—"]})]})]})},`${s._kitId}-${s._medIndex}-${h}`))})]})]})}const pe="__documentId__";function D(t){if(t&&typeof t=="object"&&t.__supabaseServerTs)return new Date().toISOString();if(Array.isArray(t))return t.map(D);if(t!==null&&typeof t=="object"){const o={};for(const a in t)o[a]=D(t[a]);return o}return t}function K(t,o){if(!o)return null;const a=o.id;if(t==="prod_kits"){const u=o.payload||{};return{id:a,patientId:o.patientId,...u}}if(t==="prod_templates"){const u=o.payload||{};return{id:a,...u,createdAt:o.createdAt,updatedAt:o.updatedAt}}if(t==="prod_templates_ruta"){const u=o.payload||{};return{id:a,...u,savedAt:o.savedAt}}return{id:a,...o}}function he(t,o){const a=K(t,o);return a?{id:a.id,exists:!0,data:()=>a}:null}function R(t){const o={};for(const a in t)a!=="id"&&(o[a]=t[a]);return o}function ge(t){const o=l=>l;function a(l){const r=o(l);let i=null,x=[],d=null,y=null,v=null,p=null;const _={doc(s){const h={_id:s===void 0?null:s};return{_collection:l,_id:h._id,async get(){const n=l;if(n==="prod_kits"){const c=await t.from(r).select("*").eq("id",s).maybeSingle();if(c.error)throw{code:c.error.code||"unknown",message:c.error.message};const g=c.data;return g?{exists:!0,id:g.id,data:()=>K(r,g)}:{exists:!1,id:s,data:()=>({})}}if(n==="prod_templates_ruta"){const c=await t.from(r).select("*").eq("id",s).maybeSingle();if(c.error)throw{code:c.error.code,message:c.error.message};const g=c.data;return g?{exists:!0,id:g.id,data:()=>({...g.payload,savedAt:g.savedAt})}:{exists:!1,id:s,data:()=>({})}}const m=s??h._id;if(!m)return{exists:!1,id:null,data:()=>({})};const f=await t.from(r).select("*").eq("id",m).maybeSingle();if(f.error)throw{code:f.error.code,message:f.error.message};return f.data?he(r,f.data):{exists:!1,id:m,data:()=>({})}},async update(n){n=D(n);const m=s??h._id;if(!m)return;if(r==="prod_kits"){const c=await t.from(r).select("*").eq("id",m).maybeSingle();if(c.error)throw{code:c.error.code,message:c.error.message};const g=c.data,w=g!=null&&g.payload&&typeof g.payload=="object"?{...g.payload}:{},b={},N=[];for(const q in n)if(q!=="patientId"&&q!=="id"){const k=n[q];k&&typeof k=="object"&&k.__supabaseDelete?(N.push(q),delete w[q]):k!==void 0&&!(q==="fechaEntregaKit"&&(k===""||k===null))?b[q]=k:q==="fechaEntregaKit"&&(k===""||k===null)&&(N.push(q),delete w[q])}const I={...w,...b};N.forEach(q=>delete I[q]);const O={payload:I};n.patientId!==void 0&&(O.patientId=n.patientId);const E=await t.from(r).update(O).eq("id",m);if(E.error)throw{code:E.error.code,message:E.error.message};return}if(r==="prod_templates"){const c=R(n),g=await t.from(r).update({payload:c,updatedAt:new Date().toISOString()}).eq("id",m);if(g.error)throw{code:g.error.code,message:g.error.message};return}if(r==="prod_templates_ruta"){const c=await t.from(r).update({payload:n,savedAt:new Date().toISOString()}).eq("id",m);if(c.error)throw{code:c.error.code,message:c.error.message};return}const f=await t.from(r).update(n).eq("id",m);if(f.error)throw{code:f.error.code,message:f.error.message}},async set(n){n=D(n);const m=s??h._id;if(r==="prod_kits"){const c=n.patientId,g={};for(const b in n)b!=="patientId"&&b!=="id"&&(g[b]=n[b]);const w=await t.from(r).upsert({id:m,patientId:c,payload:g},{onConflict:"id"});if(w.error)throw{code:w.error.code,message:w.error.message};return}if(r==="prod_templates"){const c=R(n),g={id:m,payload:c,updatedAt:new Date().toISOString()},w=await t.from(r).upsert(g,{onConflict:"id",ignoreDuplicates:!1});if(w.error)throw{code:w.error.code,message:w.error.message};return}if(r==="prod_templates_ruta"){const c=await t.from(r).upsert({id:m,payload:n,savedAt:new Date().toISOString()},{onConflict:"id"});if(c.error)throw{code:c.error.code,message:c.error.message};return}const f=await t.from(r).upsert({id:m||s,...n},{onConflict:"id"});if(f.error)throw{code:f.error.code,message:f.error.message}},async delete(){const n=s??h._id;if(!n)return;const m=await t.from(r).delete().eq("id",n);if(m.error)throw{code:m.error.code,message:m.error.message}},onSnapshot(n){let m=null;const f=()=>{_.get().then(g=>{const w=g.docs||[],b=JSON.stringify(w.map(N=>N.id+(N.data?N.data():{})));m!==b&&(m=b,n({docs:w}))}).catch(()=>{})};f();const c=setInterval(f,3e3);return()=>clearInterval(c)}}},async add(s){if(s=D(s),r==="prod_kits"){const n=s.patientId,m={};for(const c in s)c!=="patientId"&&c!=="id"&&(m[c]=s[c]);const f=await t.from(r).insert({patientId:n,payload:m}).select("id").single();if(f.error)throw{code:f.error.code,message:f.error.message};return{id:f.data.id}}if(r==="prod_patient_reports"){const n={type:s.type,added:s.added??null,addedCount:s.addedCount??0,updatedCount:s.updatedCount??0,by:s.by??null,patientId:s.patientId??null,dni:s.dni??null,nombre:s.nombre??null,telefono:s.telefono??null,direccion:s.direccion??null,descripcionMunicipio:s.descripcionMunicipio??null,tipoAfiliado:s.tipoAfiliado??null},m=await t.from(r).insert(n).select("id").single();if(m.error)throw{code:m.error.code,message:m.error.message};return{id:m.data.id}}const h=await t.from(r).insert(s).select("id").single();if(h.error)throw{code:h.error.code,message:h.error.message};return{id:h.data.id}},where(s,h,n){return i={field:s,op:h,value:n},_},orderBy(s,h){return x.push({field:s===pe?"id":s,dir:h||"asc"}),_},limit(s){return d=s,_},startAfter(s,h){return y=[s,h],_},startAt(s){return v=s,_},endAt(s){return p=s,_},async get(){var f,c,g,w;let s=t.from(r).select("*");if((i==null?void 0:i.op)==="=="&&(s=s.eq(i.field,i.value)),x.length){const b=x[0];s=s.order(b.field,{ascending:b.dir!=="desc"});for(let N=1;N<x.length;N++){const I=x[N];s=s.order(I.field,{ascending:I.dir!=="desc"})}}if(v!=null&&(s=s.gte(((f=x[0])==null?void 0:f.field)||"id",v)),p!=null&&(s=s.lte(((c=x[0])==null?void 0:c.field)||"id",p)),(y==null?void 0:y.length)>=1){const b=((g=x[0])==null?void 0:g.field)||"id",N=y[0];y[1]!=null&&b!=="id"?(s=s.gte(b,N).order(b,{ascending:!0}).order("id",{ascending:!0}),d!=null&&(s=s.limit(d*3))):s=s.gt(b,N)}d!=null&&!((y==null?void 0:y.length)>=2)&&(s=s.limit(d));const h=await s;if(h.error)throw{code:h.error.code,message:h.error.message};let n=h.data||[];if((y==null?void 0:y.length)>=2){const[b,N]=y,I=((w=x[0])==null?void 0:w.field)||"id";n=n.filter(O=>{const E=O[I],q=O.id;return E>b||E===b&&q>N}),d!=null&&(n=n.slice(0,d))}const m=n.map(b=>{const N=K(r,b),I={_collection:r,_id:b.id};return{id:b.id,ref:I,data:()=>N}});return{docs:m,empty:m.length===0}},onSnapshot(s){let h=null;const n=()=>{_.get().then(f=>{const c=f.docs||[],g=JSON.stringify(c.map(w=>{var b;return`${w.id}:${JSON.stringify(((b=w.data)==null?void 0:b.call(w))??{})}`}));h!==g&&(h=g,s(f))}).catch(()=>{})};n();const m=setInterval(n,1e3);return()=>clearInterval(m)}};return _}function u(){const l=[];return{update(r,i){l.push({type:"update",table:r._collection,id:r._id,data:D(i)})},set(r,i){l.push({type:"set",table:r._collection,id:r._id,data:D(i)})},async commit(){for(let r=0;r<l.length;r++){const i=l[r],x=i.table;i.type==="update"?x==="prod_templates"?await t.from(x).update({payload:R(i.data),updatedAt:new Date().toISOString()}).eq("id",i.id):await t.from(x).update(i.data).eq("id",i.id):i.id==null?await t.from(x).insert(i.data).select("id").single():x==="prod_templates"?await t.from(x).upsert({id:i.id,payload:R(i.data),updatedAt:new Date().toISOString()},{onConflict:"id"}):await t.from(x).upsert({id:i.id,...i.data},{onConflict:"id"})}}}}return{collection(l){const r=a(l);return r.doc=i=>{const x={_collection:l,_id:i},d=a(l).doc(i);return d.ref=x,d},r},batch:u}}const be="https://nevnnxjicyhwkzrgtadu.supabase.co",ye="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5ldm5ueGppY3lod2t6cmd0YWR1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjkxMjc4ODksImV4cCI6MjA4NDcwMzg4OX0._pewkeLOL68mlJ6uIq7yMjDDcISMSZMfdGFK0m3K6KI";let P=null,T=null;function Y(){return P||(P=Q(be,ye)),P}function L(){return T||(T=ge(Y())),T}async function X(){return L(),{db:L()}}const je=Object.freeze(Object.defineProperty({__proto__:null,getDb:L,getSupabase:Y,initSupabase:X},Symbol.toStringTag,{value:"Module"})),z="logistica_kits_cache",we=7*24*60*60*1e3;function ve(t){try{const o=localStorage.getItem(t);if(!o)return null;const{data:a,timestamp:u}=JSON.parse(o);return Date.now()-u>we?null:a}catch{return null}}function J(t,o){try{localStorage.setItem(t,JSON.stringify({data:o,timestamp:Date.now()}))}catch{}}function Ne(t){const[o,a]=j.useState([]),[u,l]=j.useState([]),[r,i]=j.useState([]),[x,d]=j.useState(!0),[y,v]=j.useState(null),p=j.useCallback(async()=>{const f=((await L().collection("prod_kits").get()).docs||[]).map(c=>({id:c.id,...c.data()}));return f.sort((c,g)=>new Date(g.fechaArmado||0)-new Date(c.fechaArmado||0)),J(z,f),a(f),f},[]),_=j.useCallback(async()=>{const m=await L().collection("prod_patients").get();l((m.docs||[]).map(f=>({id:f.id,...f.data()})))},[]),s=j.useCallback(async()=>{const m=await L().collection("prod_users").get();i((m.docs||[]).map(f=>({id:f.id,...f.data()})))},[]),h=j.useCallback(async()=>{try{localStorage.removeItem(z),await p()}catch(n){v((n==null?void 0:n.message)||n)}},[p]);return j.useEffect(()=>{if(!t){d(!1);return}let n=!1;return d(!0),v(null),(async()=>{try{const m=L(),f=ve(z);if(f&&Array.isArray(f)&&a(f),await Promise.all([p(),_(),s()]),n)return;const c=m.collection("prod_kits").onSnapshot(g=>{const w=(g.docs||[]).map(b=>({id:b.id,...b.data()}));w.sort((b,N)=>new Date(N.fechaArmado||0)-new Date(b.fechaArmado||0)),J(z,w),a(w)});return()=>c()}catch(m){n||v((m==null?void 0:m.message)||m)}finally{n||d(!1)}})(),()=>{n=!0}},[t,p,_,s]),{kits:o,patients:u,users:r,loading:x,error:y,refetchKits:h}}function _e(){const[t,o]=j.useState(()=>sessionStorage.getItem("leq_role")),[a,u]=j.useState(()=>sessionStorage.getItem("leq_username")),[l,r]=j.useState(()=>{try{return JSON.parse(sessionStorage.getItem("leq_userData")||"null")}catch{return null}}),[i,x]=j.useState("medicamentos"),[d,y]=j.useState(!1),[v,p]=j.useState(!1),_=!!t,{kits:s,patients:h,loading:n,error:m}=Ne(_),f=(w,b,N)=>{o(w),u(b),r(N),sessionStorage.setItem("leq_role",w),sessionStorage.setItem("leq_username",b),N&&sessionStorage.setItem("leq_userData",JSON.stringify(N))},c=()=>{o(null),u(null),r(null),sessionStorage.removeItem("leq_role"),sessionStorage.removeItem("leq_username"),sessionStorage.removeItem("leq_userData"),window.location.href="index.html"},g=j.useMemo(()=>({name:a,role:t,...l||{}}),[a,t,l]);return t?e.jsxs("div",{className:"relative flex h-full w-full min-h-0 overflow-hidden","data-theme":"nueva",children:[e.jsxs("div",{className:"pointer-events-none absolute inset-0 overflow-hidden",children:[e.jsx("div",{className:"futuro-orb -translate-y-1/2 translate-x-1/2 top-0 right-0 h-[400px] w-[400px] rounded-full bg-turquoise-200/20 blur-3xl"}),e.jsx("div",{className:"futuro-orb translate-y-1/2 -translate-x-1/2 bottom-0 left-0 h-[300px] w-[300px] rounded-full bg-clinical-200/15 blur-3xl"})]}),v&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex flex-col bg-gradient-to-br from-turquoise-900 via-teal-900 to-turquoise-900/98 backdrop-blur-md md:hidden",style:{paddingTop:"env(safe-area-inset-top)",paddingBottom:"env(safe-area-inset-bottom)"},children:[e.jsxs("div",{className:"flex shrink-0 items-center justify-between border-b border-turquoise-800 p-4",children:[e.jsx("div",{className:"flex items-center gap-2 text-xl font-bold text-white font-display",children:e.jsx("span",{children:"IHSS A TU CASA"})}),e.jsx("button",{type:"button",onClick:()=>p(!1),className:"flex min-h-[44px] min-w-[44px] items-center justify-center rounded-full bg-turquoise-800 p-3 text-white","aria-label":"Cerrar menú",children:e.jsx(S.X,{size:24})})]}),e.jsxs("div",{className:"flex-1 space-y-1 overflow-y-auto p-6",children:[e.jsxs("button",{type:"button",onClick:()=>{x("dashboard"),p(!1)},className:"flex w-full items-center gap-4 rounded-2xl px-4 py-3.5 font-bold text-turquoise-300 transition hover:bg-turquoise-800/50 min-h-[48px]",children:[e.jsx(S.LayoutDashboard,{size:20}),e.jsx("span",{children:"Dashboard"})]}),e.jsxs("button",{type:"button",onClick:()=>{x("medicamentos"),p(!1)},className:"flex w-full items-center gap-4 rounded-2xl px-4 py-3.5 font-bold text-turquoise-300 transition hover:bg-turquoise-800/50 min-h-[48px]",children:[e.jsx(S.Pill,{size:20}),e.jsx("span",{children:"Medicamentos"})]}),e.jsx("div",{className:"border-t border-turquoise-800 pt-6 mt-4",children:e.jsxs("button",{type:"button",onClick:c,className:"flex w-full items-center gap-4 rounded-2xl bg-turquoise-800 px-4 py-3.5 font-bold text-white min-h-[48px]",children:[e.jsx(S.LogOut,{size:16}),"Cerrar sesión"]})})]})]}),e.jsxs("aside",{className:`relative z-20 hidden flex-col border-r border-turquoise-700/50 bg-gradient-to-b from-turquoise-900 via-turquoise-800 to-teal-900 text-turquoise-100 shadow-2xl transition-all duration-300 ease-in-out md:flex ${d?"w-24":"w-72"}`,children:[e.jsxs("div",{className:`relative z-10 flex ${d?"justify-center":"justify-between"} items-center p-6 pb-2`,children:[!d&&e.jsx("div",{className:"flex items-center gap-3 text-white",children:e.jsx("span",{className:"text-2xl font-bold font-display",children:"IHSS"})}),e.jsx("button",{type:"button",onClick:()=>y(!d),className:"absolute right-4 top-6 rounded-lg p-1 text-turquoise-400 transition hover:bg-turquoise-800 hover:text-white",children:e.jsx(S.ArrowLeft,{size:20})})]}),!d&&e.jsx("div",{className:"mb-4 pl-14 text-xs font-bold uppercase tracking-widest text-turquoise-400",children:"A TU CASA"}),e.jsxs("nav",{className:"relative z-10 flex-1 space-y-2 overflow-x-hidden overflow-y-auto px-4 py-4",children:[e.jsxs("button",{type:"button",onClick:()=>x("dashboard"),className:`flex w-full items-center gap-4 rounded-2xl px-4 py-3.5 font-bold transition min-h-[48px] ${i==="dashboard"?"bg-gradient-to-r from-turquoise-500 to-turquoise-600 text-white shadow-lg":"text-turquoise-300 hover:bg-turquoise-800/50"} ${d?"justify-center":""}`,children:[e.jsx(S.LayoutDashboard,{size:20,className:"shrink-0"}),e.jsx("span",{className:d?"hidden":"",children:"Dashboard"})]}),e.jsxs("button",{type:"button",onClick:()=>x("medicamentos"),className:`flex w-full items-center gap-4 rounded-2xl px-4 py-3.5 font-bold transition min-h-[48px] ${i==="medicamentos"?"bg-gradient-to-r from-turquoise-500 to-turquoise-600 text-white shadow-lg":"text-turquoise-300 hover:bg-turquoise-800/50"} ${d?"justify-center":""}`,children:[e.jsx(S.Pill,{size:20,className:"shrink-0"}),e.jsx("span",{className:d?"hidden":"",children:"Medicamentos"})]})]}),e.jsxs("div",{className:"relative z-10 mx-4 mb-4 rounded-2xl border border-turquoise-700/50 bg-turquoise-800/50 p-4",children:[e.jsxs("div",{className:`mb-4 flex items-center gap-3 ${d?"flex-col justify-center":""}`,children:[e.jsx("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-gradient-to-br from-clinical-400 to-clinical-600 text-sm font-bold text-white",children:"LG"}),!d&&e.jsxs("div",{className:"overflow-hidden",children:[e.jsx("div",{className:"truncate text-sm font-bold text-white capitalize",children:a}),e.jsx("div",{className:"truncate text-[10px] text-turquoise-300",children:"Logística"})]})]}),e.jsxs("button",{type:"button",onClick:c,className:"flex w-full items-center justify-center gap-2 rounded-xl py-2.5 text-xs font-bold text-turquoise-200 transition hover:bg-turquoise-700 hover:text-white",title:"Cerrar sesión",children:[e.jsx(S.LogOut,{size:16}),!d&&e.jsx("span",{children:"Salir"})]})]})]}),e.jsxs("main",{className:"main-col relative z-10 flex min-h-0 flex-1 flex-col overflow-x-hidden overflow-hidden bg-gradient-to-br from-turquoise-50/95 via-white/80 to-clinical-50/95 transition-all duration-300",children:[e.jsxs("header",{className:"fixed left-0 right-0 top-0 z-[60] flex h-14 shrink-0 items-center justify-between border-b border-slate-200/80 bg-white/90 px-4 shadow-sm backdrop-blur-xl md:hidden",style:{paddingTop:"env(safe-area-inset-top)",paddingLeft:"max(1rem, env(safe-area-inset-left))",paddingRight:"max(1rem, env(safe-area-inset-right))"},children:[e.jsx("button",{type:"button",onClick:()=>p(!0),className:"-ml-2 flex min-h-[44px] min-w-[44px] items-center justify-center rounded-xl p-2 text-slate-600","aria-label":"Abrir menú",children:e.jsx(S.Menu,{size:24})}),e.jsx("div",{className:"flex flex-1 justify-center truncate text-base font-bold text-slate-800 font-display",children:"IHSS A TU CASA — Logística"}),e.jsx("div",{className:"w-10 shrink-0","aria-hidden":"true"})]}),e.jsxs("div",{className:"mobile-content-area relative z-10 min-w-0 flex-1 overflow-x-hidden overflow-y-auto p-4 pt-14 scroll-smooth md:p-8 md:pt-8",children:[m&&e.jsx("div",{className:"mb-4 rounded-xl border border-red-200 bg-red-50 p-4 text-sm font-bold text-red-600",children:m}),n&&e.jsxs("div",{className:"mb-4 flex items-center gap-2 text-sm text-slate-500",children:[e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-turquoise-500 border-t-transparent"}),"Cargando datos..."]}),i==="dashboard"&&e.jsx(ce,{userName:a,role:t,kits:s,currentUser:g,setView:x}),i==="medicamentos"&&e.jsx(fe,{kits:s,patients:h})]})]})]}):e.jsx(de,{onLogin:f})}function Se(){const[t,o]=j.useState(!1),[a,u]=j.useState(null);return j.useEffect(()=>{X().then(()=>o(!0)).catch(l=>u((l==null?void 0:l.message)||"Error al conectar"))},[]),a?e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-slate-100 p-6",children:e.jsxs("div",{className:"max-w-md rounded-2xl bg-white p-8 text-center shadow-lg",children:[e.jsx("p",{className:"mb-2 font-bold text-red-600",children:"Error de conexión"}),e.jsx("p",{className:"mb-4 text-sm text-slate-600",children:a}),e.jsx("button",{type:"button",onClick:()=>window.location.reload(),className:"rounded-xl bg-turquoise-500 px-6 py-2 font-bold text-white",children:"Reintentar"})]})}):t?e.jsx(_e,{}):e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-gradient-to-br from-turquoise-100 via-slate-50 to-clinical-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 h-16 w-16 animate-spin rounded-full border-4 border-turquoise-500 border-t-transparent"}),e.jsx("p",{className:"font-bold text-slate-600",children:"Iniciando plataforma..."})]})})}const W=document.getElementById("root");if(!W)throw new Error("Elemento #root no encontrado.");const qe=$.createRoot(W);qe.render(e.jsx(Z.StrictMode,{children:e.jsx(Se,{})}));
